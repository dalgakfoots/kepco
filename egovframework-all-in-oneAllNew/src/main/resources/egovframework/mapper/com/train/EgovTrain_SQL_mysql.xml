<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovTrainDAO">
    
    <select id="selectUserVmGroupId" resultType="java.util.HashMap">
    	SELECT A.MBER_ID,
    		   A.ESNTL_ID,
    		   A.GROUP_ID,
    	<choose>
    		<when test='trainType == "pst"'>
    		   B.PST_VM_ID AS VM_GROUP_ID
    		</when>
    		<when test='trainType == "mdt"'>
    		   B.MDT_VM_ID AS VM_GROUP_ID
    		</when>
    		<when test='trainType == "wat"'>
    		   B.WAT_VM_ID AS VM_GROUP_ID
    		</when>
    	</choose>
		FROM   comtngnrlmber A
		       LEFT OUTER JOIN kepco_training_team_vmgroup B
		                    ON A.group_id = B.team_id
		WHERE  A.esntl_id = #{esntlId}
    </select>
    
	<select id="selectUserVMLists" resultType="java.util.HashMap">

		SELECT mber_id,
		       group_id,
		       vm_group_id,
		       vm_type_id,
		       url
		FROM   (SELECT A.mber_id,
		               A.group_id,
		               B.pst_vm_id AS VM_GROUP_ID,
		               C.vm_type_id,
		               C.url
		        FROM   comtngnrlmber A
		               LEFT OUTER JOIN kepco_training_team_vmgroup B
		                            ON A.group_id = B.team_id
		               LEFT OUTER JOIN kepco_vm_group_types C
		                            ON B.pst_vm_id = C.vm_group_id
		        WHERE  A.esntl_id = #{esntlId}
		        UNION ALL
		        SELECT A.mber_id,
		               A.group_id,
		               B.mdt_vm_id AS VM_GROUP_ID,
		               C.vm_type_id,
		               C.url
		        FROM   comtngnrlmber A
		               LEFT OUTER JOIN kepco_training_team_vmgroup B
		                            ON A.group_id = B.team_id
		               LEFT OUTER JOIN kepco_vm_group_types C
		                            ON B.mdt_vm_id = C.vm_group_id
		        WHERE  A.esntl_id = #{esntlId}
		        UNION ALL
		        SELECT A.mber_id,
		               A.group_id,
		               B.wat_vm_id AS VM_GROUP_ID,
		               C.vm_type_id,
		               C.url
		        FROM   comtngnrlmber A
		               LEFT OUTER JOIN kepco_training_team_vmgroup B
		                            ON A.group_id = B.team_id
		               LEFT OUTER JOIN kepco_vm_group_types C
		                            ON B.wat_vm_id = C.vm_group_id
		        WHERE  A.esntl_id = #{esntlId}) A 
		WHERE	VM_GROUP_ID = #{vmGroupId}
	</select>
	
</mapper>