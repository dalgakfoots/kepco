<?xml version="1.0" encoding="UTF-8"?><!-- 
	수정일                 수정자                          수정내용
  =========     =======    =================================================
  2011.9.5   	정진오     	 	selectFaqList에 Alias 추가
  							FRST_REGIST_PNTTM ->  	FRST_REGISTER_PNTTM
							LAST_UPDT_PNTTM -> 		LAST_UPDUSR_PNTTM 
							RDCNT ->				INQIRE_CO
  2011.09.26        서준식		selectFaqList 문의 FRST_REGIST_PNTTM, LAST_UPDT_PNTTM 컬럼에  DATE_FORMAT 함수 적용							 							
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FaqManage">

	<resultMap id="FaqManage" type="egovframework.com.uss.olh.faq.service.FaqVO">
		<result property="faqId" column="FAQ_ID"/>
		<result property="qestnSj" column="QESTN_SJ"/>
		<result property="qestnCn" column="QESTN_CN"/>
		<result property="answerCn" column="ANSWER_CN"/>
		<result property="inqireCo" column="RDCNT"/>
		<result property="atchFileId" column="ATCH_FILE_ID"/>		
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="lastUpdusrPnttm" column="LAST_UPDT_PNTTM"/>
		<result property="lastUpdusrId" column="LAST_UPDUSR_ID"/>				
	</resultMap>
	
	<resultMap id="FaqGroupManage" type="egovframework.com.uss.olh.faq.service.FaqGroupVO">
		<result property="faqGroupId" column="FAQ_GROUP_ID"/>
		<result property="faqGroupNm" column="FAQ_GROUP_NM"/>
		<result property="faqGroupDc" column="FAQ_GROUP_DC"/>
		<!-- <result property="type" column="TYPE"/>  -->
	</resultMap>
	
	<resultMap id="FaqGroupRelationManage" type="egovframework.com.uss.olh.faq.service.FaqGroupRelationVO">
		<result property="id" column="ID"/>
		<result property="faqGroupId" column="FAQ_GROUP_ID"/>
		<result property="faqId" column="FAQ_ID"/>
	</resultMap>
	
	<select id="selectFaqDetail" resultMap="FaqManage">
				
			SELECT 	FAQ_ID, 
					QESTN_SJ, 
					QESTN_CN, 
					ANSWER_CN, 
					RDCNT, 
					ATCH_FILE_ID,
					DATE_FORMAT(FRST_REGIST_PNTTM,'%Y-%m-%d') FRST_REGIST_PNTTM,
					FRST_REGISTER_ID, 
					DATE_FORMAT(LAST_UPDT_PNTTM,'%Y-%m-%d') LAST_UPDT_PNTTM,
					LAST_UPDUSR_ID			 			  			 			  
			FROM	COMTNFAQINFO		
			WHERE	FAQ_ID=#{faqId}					
		
	</select>
	
	<select id="selectFaqList" parameterType="egovframework.com.uss.olh.faq.service.FaqVO" resultMap="FaqManage">
		
			SELECT
				FAQ_ID,
				QESTN_SJ,
				QESTN_CN,
				ANSWER_CN,
				RDCNT,
				ATCH_FILE_ID,
				DATE_FORMAT(FRST_REGIST_PNTTM,'%Y-%m-%d') 	FRST_REGIST_PNTTM,
				FRST_REGISTER_ID,
				DATE_FORMAT(LAST_UPDT_PNTTM,'%Y-%m-%d') 	LAST_UPDUSR_PNTTM,
				LAST_UPDUSR_ID			 
			FROM	COMTNFAQINFO                               			
			WHERE	1=1   			
							
			<if test="searchCnd == 0">AND
				QESTN_SJ LIKE CONCAT('%', #{searchWrd}, '%')
			</if>
			ORDER BY FAQ_ID DESC			
			LIMIT  #{recordCountPerPage} OFFSET #{firstIndex}	
	</select>
	
	<select id="selectFaqListCnt" parameterType="egovframework.com.uss.olh.faq.service.FaqVO" resultType="int">
		
			SELECT 	COUNT(*) totcnt
			FROM 	COMTNFAQINFO
			WHERE 	1=1
					
			<if test="searchCnd == 0">AND
				QESTN_SJ LIKE CONCAT('%', #{searchWrd}, '%')
			</if>
	</select>
	
	<select id="selectFaqGroupList" resultType="java.util.HashMap">
	
			SELECT FAQ_GROUP_ID,
				   FAQ_GROUP_NM,
				   FAQ_GROUP_DC,
				   TYPE,
				   CREATED_DATETIME
			  FROM KEPCO_EXAM_GROUP
			 LIMIT  #{recordCountPerPage} OFFSET #{firstIndex}	
			 
	</select>
	
	
	<select id="selectFaqGroupListCnt" resultType="int">
			
			SELECT 	COUNT(*) totcnt
			FROM 	KEPCO_EXAM_GROUP
			WHERE 	1=1
			
	</select>
	
	<select id="selectFaqGroup" resultMap="FaqGroupManage">
		SELECT FAQ_GROUP_ID,
			   FAQ_GROUP_NM,
			   FAQ_GROUP_DC,
			   TYPE
		  FROM KEPCO_EXAM_GROUP
		 WHERE FAQ_GROUP_ID = #{faqGroupId}
	</select>
	
	<select id="selectFaqGroupRelationList" resultType="java.util.HashMap">
			
			SELECT A.FAQ_ID,
				   A.QESTN_SJ
		   	  FROM COMTNFAQINFO A LEFT OUTER JOIN KEPCO_EXAM_GROUP_FAQINFO B
		   	    ON A.FAQ_ID = B.FAQ_ID
		   	 WHERE B.FAQ_GROUP_ID = #{faqGroupId}
	
	</select>
	
	<insert id="insertFaq">	
			
			INSERT INTO COMTNFAQINFO
				   (FAQ_ID
				  , QESTN_SJ
				  , QESTN_CN
				  , ANSWER_CN
				  , RDCNT
				  , ATCH_FILE_ID
				  , FRST_REGIST_PNTTM 
				  , FRST_REGISTER_ID 
				  , LAST_UPDT_PNTTM 
				  , LAST_UPDUSR_ID) 
			VALUES ( #{faqId}
				  , #{qestnSj}
				  , #{qestnCn}
				  , #{answerCn}
				  , 0
				  <choose>
				  	<when test="atchFileId == '' ">
				  	,NULL
				  	</when>
				  	<otherwise>
				  	, #{atchFileId}
				  	</otherwise>
				  </choose>
				  , sysdate()
				  , #{frstRegisterId}
				  , sysdate()
				  , #{lastUpdusrId} )
		
	</insert>
	
	<insert id="insertFaqGroup">
		
		INSERT INTO KEPCO_EXAM_GROUP
			   (FAQ_GROUP_ID,
			    FAQ_GROUP_NM,
			    FAQ_GROUP_DC
			   )VALUES(
			    #{faqGroupId},
			    #{faqGroupNm},
			    #{faqGroupDc}
			   )
	
	</insert>
	
	<insert id="insertFaqGroupRelation">
	
			INSERT INTO KEPCO_EXAM_GROUP_FAQINFO
			      (ID,
			       FAQ_GROUP_ID,
			       FAQ_ID
			      )VALUES(
			       #{id},
			       #{faqGroupId},
			       #{faqId}
			      )
	
	</insert>
	
	<update id="updateFaqInqireCo">
				
			UPDATE	COMTNFAQINFO	SET
				    RDCNT= IFNULL(RDCNT,0) + 1				  			
 			WHERE  FAQ_ID=#{faqId}
		
	</update>

	<update id="updateFaq">
		
			UPDATE	COMTNFAQINFO	SET
					FAQ_ID=#{faqId} 
				  , QESTN_SJ=#{qestnSj}
				  , QESTN_CN=#{qestnCn}
				  , ANSWER_CN=#{answerCn}
				  , ATCH_FILE_ID=#{atchFileId}				  			
				  , LAST_UPDT_PNTTM=sysdate()
				  , LAST_UPDUSR_ID=#{lastUpdusrId}
 			WHERE  FAQ_ID=#{faqId}
		
	</update>
	
	<update id="updateFaqGroup">
	
			UPDATE KEPCO_EXAM_GROUP
			   SET FAQ_GROUP_NM = #{faqGroupNm},
			   	   FAQ_GROUP_DC = #{faqGroupDc}
			 WHERE FAQ_GROUP_ID = #{faqGroupId}
	
	</update>
	
	<delete id="deleteFaq">
		
			DELETE FROM COMTNFAQINFO 
			WHERE  FAQ_ID=#{faqId}
		
	</delete>
	
	<delete id ="deleteFaqGroup">
			
			DELETE FROM KEPCO_EXAM_GROUP
			 WHERE FAQ_GROUP_ID=#{faqGroupId}
	</delete>
	
	<delete id ="deleteFaqGroupRelation">
	
			DELETE FROM KEPCO_EXAM_GROUP_FAQINFO
			 WHERE FAQ_GROUP_ID=#{faqGroupId}
	
	</delete>
	
</mapper>